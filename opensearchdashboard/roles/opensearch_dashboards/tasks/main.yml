---

- hostname:
    name: "{{ inventory_hostname }}"

# Disabling for Amazon Linux 2 as selinux is disabled by default.
# - name: Disable the selinux
#   selinux:
#     state: disabled
#   when: (ansible_distribution != "Ubuntu") and (ansible_distribution != "Amazon")

# - name: Populate the nodes to /etc/hosts
#   import_tasks: etchosts.yml

# - name: Tune the system settings
#   import_tasks: tune.yml

- name: include dashboards installation
  include: dashboards.yml

- name: Make sure opensearch dashboards is started
  service:
    name: dashboards
    state: started
    enabled: yes

- name: Get all the installed dashboards plugins
  command: "sudo -u {{ os_dashboards_user }} {{ os_plugin_bin_path }} list"
  register: list_plugins

- name: Show all the installed dashboards plugins
  debug:
    msg: "{{ list_plugins.stdout }}"

- name: "Copy configuration files from template to configuration directory"
  template:
    src: "dashboard.ndjson"
    dest: "/home/dashboard.ndjson"

- name: shell command
  shell: 'curl -H "Content-Type: application/x-ndjson" -POST https://{{ opensearch_dashboard_host }}/_dashboards/api/opensearch-dashboards/dashboards/import?exclude=index-pattern&force=true -u 'admin:admin' --insecure --data-binary "@/home/dashboard.ndjson"'
  